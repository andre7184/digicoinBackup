{% extends "base.html" %}
{% load static %}
{% block content %}
<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Histórico de Compra</title>
    <link rel="stylesheet" href="{% static 'css/UserCss/historicoCompra.css' %}">

</head>
<body>
  {% include "components/user/menuUser.html" %}

    <div class="historico-compra-tela">
        <div class="historico-compra-container">
            <div class="historico-compra-cabecalho">
                <div class="historico-compra-titulo">
                    <div class="historico-compra-titulo-icone">
                        <img src="{% static 'img/historico.png' %}" alt="icone historico">
                        <h2 class="titulo-historico">Histórico de Compras</h2>
                    </div>
                    <div class="historico-compra-cabecalho-underline"></div>
                </div>
                <div class="historico-compra-barra-pesquisa">
                    <form method="GET" action="{% url 'historicoCompra' %}">
                        <div class="historico-compra-barra-pesquisa-busca-container">
                            <div class="historico-compra-barra-pesquisa-busca-container1">
                            <img src="{% static 'img/iconeLupa.png' %}" alt="/Lupa">
                            <select id="tipoPesquisa" name="tipoPesquisa" onchange="mostrarCampoPesquisa()">
                                <option value="">Tipo</option>
                                <option value="nome">Nome do Item</option>
                                <option value="data">Data de Compra</option>
                                <option value="entrega">Tipo de entrega</option>
                                <option value="status">Status da compra</option>
                            </select>
                            </div>
                            <input type="text" id="campoNome" name="nome" placeholder="Nome" style="display:none;">
                            <input type="date" id="campoData" name="data" placeholder="Pesquisar por Data" style="display:none;">
                            <select id="campoEntrega" name="entrega" placeholder="Tipo de Entrega" style="display:none;">
                                <option value="Retirar">Retirar</option>
                                <option value="Entrega">Entregar</option>
                            </select>
                            <select id="campoStatus" name="status" placeholder="Status da compra" style="display:none;">
                                <option value="Pendente">Pendente</option>
                                <option value="Andamento">Em andamento</option>
                                <option value="Concluido">Concluido</option>
                            </select>
                            <button type="submit">Pesquisar</button>
                        </div>
                    </form>
                </div>  
            </div>        


            <div class="historico-compra-tabela">
                <div class="historico-compra-tabela-head">
                    <div class="historico-compra-tabela-rowheader">
                        <div class="historico-compra-tabela-cell itens">Itens <br><span class="historico-compra-titulo-colId-nome"></span></div>
                        <div class="historico-compra-tabela-cell quantidadeItens">Qtd</div>
                        <div class="historico-compra-tabela-cell dataCompra">Data <a href="?sort_by=dataCompra&order={% if request.GET.sort_by == 'dataCompra' and request.GET.order == 'asc' %}desc{% else %}asc{% endif %}"><img class="historico-compra-icone-sort {% if request.GET.sort_by == 'dataCompra' and request.GET.order == 'desc' %}historico-compra-sort-desc{% else %}historico-compra-sort-asc{% endif %}" src="{% static 'img/imgRanking/sort.png' %}" alt="Sort"></a></div>
                        <div class="historico-compra-tabela-cell total">Valor <a href="?sort_by=total&order={% if request.GET.sort_by == 'total' and request.GET.order == 'asc' %}desc{% else %}asc{% endif %}"><img class="historico-compra-icone-sort {% if request.GET.sort_by == 'total' and request.GET.order == 'desc' %}historico-compra-sort-desc{% else %}historico-compra-sort-asc{% endif %}" src="{% static 'img/imgRanking/sort.png' %}" alt="Sort"></a></div>
                        <div class="historico-compra-tabela-cell entrega">Tipo</div>
                        <div class="historico-compra-tabela-cell status">Status</div>
                    </div>
                </div>
                <div class="historicoCompraTabelaBody">
                    {% csrf_token %}
                    {% for compra in compra %}
                    <div class="historico-compra-tabela-row">
                        <div class="historico-compra-tabela-cell itens" data-label="Itens">
                            <div class="historico-compra-local-itens">
                                <div class="historico-compra-icone-itens">
                                    <img class="historicoCompraIconeProduto" src="{% static 'img/produto.png' %}" alt="/produto">
                                </div>
                                <div class="historico-compra-itens">
                                    {% for item in compra.itens %}
                                    <div class="historicoCompraItem">
                                       {{item.id}} - {{item.idProduto.nome}}
                                    </div>
                                    {% endfor %}
                                </div>
                            </div>
                        </div>
                        <div class="historico-compra-tabela-cell quantidadeItens" data-label="Qtd Itens">{{compra.quantidadeItens}}</div>
                        <div class="historico-compra-tabela-cell dataCompra" data-label="Data">{{compra.dataCompra|date:"d/m/Y"}}</div>
                        <div class="historico-compra-tabela-cell total" data-label="Total">{{compra.total}}</div>
                        {% if compra.entrega == 'Entrega' and compra.pedido == 'Pendente' and compra.obsEntrega != 'False' %}
                            <div class="historico-compra-tabela-cell entrega" data-label="Entrega">Em andamento</div>
                        {% else %}
                            <div class="historico-compra-tabela-cell entrega" data-label="Entrega">{{compra.entrega}}</div>
                        {% endif %}
                        <div class="historico-compra-tabela-cell pedido" data-label="Pedido">{{compra.pedido}}</div>

                    </div>
                    {% endfor %}
                </div>
            </div>

            <div class="pagination-historicoCompra" id="paginacao-historicoCompra">
                <div class="paginas-historicoCompra">
                    <div>
                        {% if compra.has_previous %}
                            <a class="anterior-historicoCompra" href="?historicoCompra_page={{ compra.previous_page_number }}">
                                <i class="fa fa-arrow-left" aria-hidden="true"></i> Anterior
                            </a>
                        {% else %}
                            <span class="anterior-historicoCompra botao-desativado-paginacao">
                                <i class="fa fa-arrow-left" aria-hidden="true"></i> Anterior
                            </span>
                        {% endif %}
                    </div>
                
                    <span>Página {{ compra.number }} de {{ compra.paginator.num_pages }}</span>
            
                    <div>
                        {% if compra.has_next %}
                            <a class="proxima-historicoCompra" href="?historicoCompra_page={{ compra.next_page_number }}">
                                Próxima <i class="fa fa-arrow-right" aria-hidden="true"></i>
                            </a>
                        {% else %}
                            <span class="proxima-historicoCompra botao-desativado-paginacao">
                                Próxima <i class="fa fa-arrow-right" aria-hidden="true"></i>
                            </span>
                        {% endif %}
                    </div>
                </div>        
            </div>
            
        </div> 
    </div>
    <script src="{% static 'js/UserJs/historicoCompra.js' %}"></script>
</body>
</html>

{% endblock  %}