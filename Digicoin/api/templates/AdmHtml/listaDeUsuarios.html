{% extends "base.html" %}
{% load static %}
{% block content %}

<link rel="stylesheet" href="{% static 'css/AdmCss/listaDeUsuarios.css'%}">
{% include "components/adm/menuAdm.html" %}
<div class="mainListaUsuarios">
    <input type="hidden" id="quantidadeTotalUsuarios" value="{{ quantidade_total }}">
    <div class="divPesquisa-listaDeUsuarios">
        <div class="barraPesquisa-listaDeUsuarios" data-url="{% url 'listaDeUsuarios' %}">
            {% if gerencia_admin %}
                <label for="filtroAdmin">
                    <input type="checkbox" id="filtroAdmin" {% if tipo_user_admin == 'true' %}checked{% endif %}>
                    Admin
                </label>
            {% endif %}
            <img src="{% static 'img/iconeLupa.png' %}" alt="Ícone de busca">
            <input id="campoBusca" name="nome" type="search" placeholder="Pesquisar nome">
            <button onclick="buscarUsuario()">Buscar</button>
        </div>
    </div>
    <div class="primeiraLinha-listaDeUsuarios">
        <h1><span>Usu</span>ários</h1>
        <div class="botoesUsuario-listaDeUsuarios">
            {% if tipo_user_admin != 'true' %}
                <button class="addMoedas-listaDeUsuarios" id="addMoedas">
                    <img src="{% static 'img/iconAdicionar.png' %}" alt="">
                    Gerir digicoins
                </button>
            {% endif %}
            <button class="addUsuarios-listaDeUsuarios" data-tipo-usuario="{{ tipo_user_admin }}" id="addUsuarios">
                <img src="{% static 'img/iconAdicionar.png' %}" alt="">
                Adicionar usuário {% if tipo_user_admin == 'true' %}Admin{% endif %}
            </button>
            {% if gerencia_admin %}
                <button class="addUsuariosFile-listaDeUsuarios" id="abrirImportarUsuarios">
                    <img src="{% static 'img/usuario-add-file.png' %}" alt="">
                    Importar usuários
                </button>
            {% endif %}
        </div>
    </div>
    <div class="head-listaDeUsuarios">
        <p>Nome</p>
        <img src="{% static 'img/lista.png' %}" alt="">
    </div>
    {% if tipo_user_admin != 'true' %}
        <div class="selecionar-todos-listaDeUsuarios">
            <label>
                <input type="checkbox" id="selecionarTodos"> 
                Selecionar todos os <span id="quantidadeSelecionados">{{quantidade_ativos}}</span> usuários ativos
            </label>
        </div>
    {% endif %}
    <div id="listaUsuarios"  class="listaUsuarios">
        {% for usuario in usuarios %}
            {% if usuario.is_active %}
                <div class="linhaUsuario-listaDeUsuarios">
                    {% if tipo_user_admin != 'true' %}
                        <input type="checkbox" class="checkbox">
                    {% endif %}
                    <div class="infoUser-listaDeUsuarios">
                        <input type="hidden" class="idUser-listaDeUsuarios" value="{{usuario.id}}">
                        <img src="{% static 'img/userBlack.png' %}" alt="">
                        <span class="nome-listaDeUsuarios">{{usuario.first_name}}</span>
                        <span class="saldo-listaDeUsuarios">{% if not usuario.is_adm %} D$ {{usuario.saldo}} {% endif %}</span>
                        <span class="status-listaDeUsuarios"></span>

                    </div>
                    <img class="iconeResetSenha-listaDeUsuarios" id="abrirResetarSenha" data-id="{{usuario.id}}" data-nome="{{usuario.first_name}}" data-email="{{usuario.username}}" src="{% static 'img/reset-senha.png' %}" alt="">
                    <img class="iconeEditar-listaDeUsuarios" id="editar" data-id="{{usuario.id}}" data-nome="{{usuario.first_name}}" data-email="{{usuario.username}}" data-ra="{{usuario.ra}}" data-status="{{usuario.is_active|lower}}" data-tipo-usuario="{{usuario.is_adm|lower}}" src="{% static 'img/edit.png' %}" alt="">
                </div>
            {% else %}
                <div class="linhaUsuario-listaDeUsuarios desativado-listaDeUsuarios">
                    <input type="checkbox" class="checkbox" disabled>
                    <div class="infoUser-listaDeUsuarios">
                        <input type="hidden" class="idUser-listaDeUsuarios" value="{{usuario.id}}">
                        <img src="{% static 'img/userBlack.png' %}" alt="">
                        <span class="nome-listaDeUsuarios">{{usuario.first_name}}</span>
                        <span class="status-listaDeUsuarios">Desativado</span>
                    </div>
                    <img class="iconeEditar-listaDeUsuarios" id="editar" data-id="{{usuario.id}}" data-nome="{{usuario.first_name}}" data-email="{{usuario.username}}" data-ra="{{usuario.ra}}" data-status="{{usuario.is_active|lower}}" data-tipo-usuario="{{usuario.is_adm|lower}}"  src="{% static 'img/edit.png' %}" alt="">
                </div>
            {% endif %}
        {% endfor%} 
    </div>
    <div class="pagination-listaDeUsuarios">
        {% if usuarios.has_previous %}
            <div>
                <a href="?{{ query_string }}&user_page={{ usuarios.previous_page_number }}">Anterior</a>
            </div>
        {% endif %}
        <span>Página {{ usuarios.number }} de {{ usuarios.paginator.num_pages }}</span>
        {% if usuarios.has_next %}
            <div>
                <a href="?{{ query_string }}&user_page={{ usuarios.next_page_number }}">Próxima</a>
            </div>
        {% endif %}
    </div>
</div>
<dialog id="popupCadastrarUsuario">
    <div class="header-cadastrarUsuario">
        <div class="headerLogo-cadastrarUsuario">
            <img src="{% static 'img/logoAdmin.png' %}" alt="LogoAdmin">
        </div>
        <div class="headerBotao-cadastrarUsuario">
            <button type="button" class="buttonClose-cadastrarUsuario">    
                <img id="fecharCadastrar" class="iconeX-cadastrarUsuario" src="{% static 'img/iconeX.png' %}" alt="">
            </button>
        </div>
    </div>
    <form method="POST" class="formUsuario-cadastrarUsuario" id="formUsuario">
        {% csrf_token %}
        <div class="input-cadastrarUsuario">
            <label for="nome">Nome do Usuário</label>
            <input type="text" id="nome" name="nome" placeholder="Digite o nome do usuário">
        </div>

        <div class="input-cadastrarUsuario">
            <label for="email">Email</label>
            <input type="email" id="email" name="email" placeholder="Digite seu email">
        </div>

        <div class="input-cadastrarUsuario">
            <label for="ra">RA do Usuário</label>
            <input type="text" id="ra" name="ra" placeholder="Número do RA">
        </div>

        <div class="input-cadastrarUsuario" id="inputSenha">
            <label for="senha">Senha temporária</label>
            <input type="password" id="senha" name="senha" placeholder="Digite a Senha">
        </div>

        <div class="input-cadastrarUsuario" id="inputDesativar">
            <label for="filtroDesativarUsuario">
                <input class="filtroDesativarUsuario" type="checkbox" id="filtroAtivarUsuario" checked>
                Ativar Usuário
            </label>
        </div>
        <input type="hidden" id="isAdmin">
        <input type="hidden" id="id_usuario">
        <button class="botaoSubmit-cadastrarUsuario" type="submit" id="cadastrarUsuario">
            Cadastrar Usuário
        </button>
    </form>
</dialog>
<dialog id="popupAdicionarMoedas">
    <div class="header-adicionarMoedas">
        <div class="headerLogo-adicionarMoedas">
            <img src="{% static 'img/logoAdmin.png' %}" alt="LogoAdmin">
        </div>
        <div class="headerBotao-adicionarMoedas">
            <button type="button" class="buttonClose-adicionarMoedas">    
                <img id="fecharAdicionarMoedas" class="iconeX-adicionarMoedas" src="{% static 'img/iconeX.png' %}" alt="">
            </button>
        </div>
    </div>
    <form class="formUsuario-AdicionarMoedas" id='formAdicionarMoedas'>
        {% csrf_token %}
        <div class="titulo-adicionarMoedas">Gerenciar digicoins</div>
        <div class="usuariosSelecionados-adicionarMoedas" id="usuariosSelecionados"></div>    
        <div class="input-adicionarMoedas">
            <label>Quantidade a ser adicionada ou removida</label>
            <input class="quantidadeInput-adicionarMoedas" id='saldo' type="number" placeholder="Digite a quantidade de digicoins">
        </div>
        <div class="botoes-adicionarMoedas">
            <button class="adicionar-adicionarMoedas" id='adicionar'>Adicionar</button>
            <button class="remover-adicionarMoedas" id='remover'>Remover</button>
        </div>
    </form>
</dialog>

<dialog id="popupResetarSenha">
    <div class="header-resetarSenha">
        <div class="headerLogo-resetarSenha">
            <img src="{% static 'img/logoAdmin.png' %}" alt="LogoAdmin">
        </div>
        <div class="headerBotao-resetarSenha">
            <button type="button" class="buttonClose-resetarSenha">    
                <img id="fecharResetarSenha" class="iconeX-resetarSenha" src="{% static 'img/iconeX.png' %}" alt="">
            </button>
        </div>
    </div>
    <form class="formUsuario-resetarSenha" id='formResetarSenha'>
        {% csrf_token %}
        <div class="titulo-resetarSenha">Resetar Senha</div>
        <input type="hidden" id="id_usuario_reset"> 
        <div class="input-resetarSenha">
            <label>Nome do Usuário</label>
            <div class="inputUsuario-resetarSenha" id="nome_usuario_reset"></div>
        </div>   
        <div class="input-resetarSenha">
            <label>E-mail do Usuário</label>
            <div class="inputUsuario-resetarSenha" id="email_usuario_reset"></div>
        </div>
        <div class="botoes-resetarSenha">
            <button class="botaoSubmit-resetarSenha" type="button" id="botaoResetarSenha">Resetar Senha</buton>
        </div>
    </form>
</dialog>

<dialog id="popupImportarUsuarios">
    <div class="header-importarUsuarios">
        <div class="headerLogo-importarUsuarios">
            <img src="{% static 'img/logoAdmin.png' %}" alt="LogoAdmin">
        </div>
        <div class="headerBotao-importarUsuarios">
            <button type="button" class="buttonClose-importarUsuarios">    
                <img id="fecharImportarUsuarios" class="iconeX-importarUsuarios" src="{% static 'img/iconeX.png' %}" alt="">
            </button>
        </div>
    </div>
    <form class="formUsuario-ImportarUsuarios" method="POST" enctype="multipart/form-data" id="formImportarUsuarios" data-urlimg="{% static 'img/uploadIcon.png' %}">
        {% csrf_token %}
        <div class="input-importarUsuarios">
            <label for="arquivoUsuarios">Faça o upload do arquivo de usuários: <a href="{% static 'usuarios_exemplo.csv' %}">Baixar exemplo</a></label>
            <label for="arquivoUsuarios" class="UploadBox uploadUsuarios">
                <div class="default-content">
                    <img src="{% static 'img/uploadIcon.png' %}" alt="uploadIcon" class="upload-icon-importarUsuarios">
                    <hr>
                    <small>Arraste e solte o arquivo aqui</small>
                    <small>para realizar upload</small>
                    <hr>
                    <small>CSV - XLSX</small>
                </div>
            </label>
            <input type="file" id="arquivoUsuarios" name="arquivo_usuarios" accept=".csv, .xlsx">
        </div>
        <div class="input-importarUsuarios">
            <button class="botaoSubmit-importarUsuarios" type="button" id="botaoValidarImportarUsuarios">Validar Usuários</button>
        </div>
    </form>
    <div class="localResultadoValidacao-importarUsuarios" id="localResultadoValidacao" style="display:none;">
        <div class="resultadoValidacao-importarUsuarios" id="resultadoValidacao" style="max-height: 200px; overflow-y: auto; padding-right: 10px;">
            <h3>Dados validados:</h3>
            <ul class="listaUsuariosValidados" id="listaUsuariosValidados"></ul>
            <span id="quantidadeUsuariosValidados"></span>
        </div>
        <button class="botaoSubmit-importarUsuarios" type="button" id="botaoCadastrarUsuariosValidados">Cadastrar</button>
        <button class="botaoSubmit-importarUsuarios" type="button" id="botaoNovoArquivo">Novo Arquivo</button>
    </div>
</dialog>

<script src="{% static 'js/AdmJS/listaDeUsuarios.js' %}"></script>
{% endblock %}